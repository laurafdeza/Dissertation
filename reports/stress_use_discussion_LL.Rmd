---
title             : "The title"
shorttitle        : "Title"

author: 
  - name          : ""
    affiliation   : ""
    corresponding : yes    # Define only one corresponding author
    address       : "Postal address"
    email         : "my@email.com"
  - name          : ""
    affiliation   : ""

affiliation:
  - id            : ""
    institution   : ""

bibliography      : 
  - "../references.bib" 
          
floatsintext      : yes
figurelist        : yes
tablelist         : yes
footnotelist      : yes
linenumbers       : yes
mask              : yes
draft             : yes

documentclass     : "apa6"
classoption       : "man"
output            : papaja::apa6_word
---

```{r setup, include = FALSE, warning = FALSE}
library("papaja")
library("officer")
library("flextable")
library("readr")
library("here")
```

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```

```{r, 'source-scripts-models', include = FALSE}
stress50 <- read_csv(here::here("data", "clean", "stress_50ms_final_onsetc3updated.csv"))

source(here::here("scripts", "01_helpers.R"))

# Get path to saved models
gca_mods_path  <- here::here("mods", "stress", "gca", "LL_changes")

# Load models as list and store full mod to global env
load(paste0(gca_mods_path, "/gca_mon_mods.Rdata"))
load(paste0(gca_mods_path, "/gca_l2_l1ot2.Rdata"))
load(paste0(gca_mods_path, "/model_preds.Rdata")) # for mon
load(paste0(gca_mods_path, "/model_preds_l1ot2.Rdata")) # for L2

```

GCA model summaries are in Appendices 2 (monolinguals) and 3 (learners).
Figure 2 represents fixations towards the target verb over time.
The figure suggests that all groups fixated on target verbs above chance before hearing the suffix, and that monolinguals fixated on targets earlier than L2ers. 



```{r, 'plot-time-course', echo=FALSE, fig.cap="Figure 2. Fixations on target verbs from 400 ms before to 400 ms after the onset of verbs’ last syllable, as a function of L1 experience. Error bars represent the 95% CI across speakers in proportion of fixations on the target.."}
knitr::include_graphics(
  here("figs", "stress", "gca", "LL_changes", "timecourse.png")
)
```

# Monolingual results

```{r, 'write-up-prep-mon', warning=F, eval=T}
# Prepare table to support easy in-line printing of equations

params <- gca_mon_mods$gca_mod_mon_base %>%
  tidy_lme4() %>% 
  rename(B = Estimate)

params$subscript <- 
  c(paste0(0:2, 0)) 

params <- tibble::column_to_rownames(params, 'subscript')

params$subscript <- 
  c(paste0(0:2, 0)) 

# Shortcut for inline reporting from the above table
report_row <- function(row_name) report_fixef_row(params, row_name)

# # Pre-calculate intercept as proportion
# b0 <- params$B[params$subscript == "00"] %>% as.numeric
# b0_prop <- b0 %>% inv_logit %>% round(2) %>% remove_leading_zero

```

The linear (`r report_row('1')`) and quadratic time terms (`r report_row('2')`) captured the GCA curve and were retained in the model.
THe model intercept estimates the log odds of monolinguals fixating on the target above chance 200 ms after the onset of the verb's final syllable at a 0.92 probability (lower bound = .90; upper bound = .94).
These numbers reveal that monolinguals used the lexical stress pattern to predict suffixes above chance.

```{r, table-mon-params, warning=F}

# Get full mod and make it pretty for the table
pretty_fixed_effects <- gca_mon_mods$gca_mod_mon_base %>%  
  tidy_lme4() %>% 
  mutate(p = format_pval(p), 
         Parameter = fix_param_names(Parameter)) %>% 
  mutate_each(funs(format_fixef_num), Estimate:t) %>% 
  rename(`_t_` = t, `_p_` = p) 

# Include gammas (Gij) after each parameter name
subs <- c(paste0(0:2, 0))
var_labels <- parenthesize(paste0(emphasize("&gamma;"), "~", subs, "~"))
pretty_fixed_effects$Parameter %<>% paste(., var_labels)

pretty_fixed_effects %>% 
  select(-effect) %>%
  knitr::kable(format = "pandoc", align = str_tokenize("lrrrr")) 


```




```{r, table-mon-probs, eval=T, echo=F, include = F}

border_1 <- fp_border(width = 1.5)
border_2 <- fp_border(width = 0.75)


model_preds$target_offset_preds_mon %>% 
  # mutate(stress = if_else(stress == 1, "Present", "Preterit")) %>% 
  # arrange(stress) %>% 
  # group_by(stress) %>%
  # distinct() %>%
  #ungroup() %>%
  # mutate(
  #        stress = blank_same_as_last(as.character(stress))) %>%
  select(Probability = prob,
         `Lower bound` = prob_lb, `Upper bound` = prob_ub) %>%
  flextable() %>% 
  width(., j = c(2, 3), width = c(1.3, 1.3)) %>%
  font(., fontname = "Times", part = "all") %>%
  fontsize(., size = 11) %>% 
  border_remove(.) %>%  
  border(., part = "header", 
            border.top = border_1,
            border.bottom = border_2) %>% 
  hline_bottom(., part = "body", border = border_1)

```


```{r, 'plot-preds-mon', echo=FALSE, fig.cap="Figure 3. Growth curve analysis estimates of fixations on target as a function of lexical stress for the Spanish monolingual speakers during the analysis window. Lines represent model estimates, and the transparent ribbons represent ±SE. Empirical logit values on y-axis correspond to proportions of 0.12, 0.50, 0.88, and 0.98. The horizontal dotted line represents the 50% probability of fixating on the targets. The vertical dotted line indicates 200 ms after the onset of the last syllable."}
knitr::include_graphics(
  here("figs", "stress", "gca", "LL_changes", "stress_mon.png")
)
```



# Learner results

```{r, 'write-up-prep-l2', warning=F, eval=T}
# Prepare table to support easy in-line printing of equations
# params <- pretty_fixed_effects %>% 
#  rename(B = Estimate)

params <- gca_l2$gca_l2_nt_2 %>%
  tidy_lme4() %>% 
  rename(B = Estimate)

params$subscript <- 
  c(paste0(0:2, 0), paste0(0, 1:2), 
          paste0(1, 1:2), paste0(0, 3:4),
          paste0(1, 3), paste0(2, 3),
          paste0(1, 4), paste0(0, 5),
          paste0(1, 5), paste0(2, 5))

params <- tibble::column_to_rownames(params, 'subscript')

params$subscript <- 
  c(paste0(0:2, 0), paste0(0, 1:2), 
          paste0(1, 1:2), paste0(0, 3:4),
          paste0(1, 3), paste0(2, 3),
          paste0(1, 4), paste0(0, 5),
          paste0(1, 5), paste0(2, 5))

# Shortcut for inline reporting from the above table
report_row <- function(row_name) report_fixef_row(params, row_name)

```

The linear (`r report_row(2)`) and quadratic (`r report_row(3)`) time terms improved the curved fit.
The probabilities of all learners fixating on targets before hearing the syllable with the suffix are above chance for all conditions (Table 2).

```{r, table-l2-params, warning=F}

# Get full mod and make it pretty for the table
pretty_fixed_effects <- gca_l2$gca_l2_nt_2 %>%  
  tidy_lme4() %>% 
  mutate(p = format_pval(p), 
         Parameter = fix_param_names(Parameter)) %>% 
  mutate_each(funs(format_fixef_num), Estimate:t) %>% 
  rename(`_t_` = t, `_p_` = p) 

# Include gammas (Gij) after each parameter name
subs <- c(paste0(0:2, 0), paste0(0, 1:2), 
          paste0(1, 1:2), paste0(0, 3:4),
          paste0(1, 3), paste0(2, 3),
          paste0(1, 4), paste0(0, 5),
          paste0(1, 5), paste0(2, 5))
var_labels <- parenthesize(paste0(emphasize("&gamma;"), "~", subs, "~"))
pretty_fixed_effects$Parameter %<>% paste(., var_labels)

pretty_fixed_effects %>% 
  select(-effect) %>%
  knitr::kable(format = "pandoc", align = str_tokenize("lrrrr")) 


```

Table ¿3?: Model estimates for probability of target fixations ±SE at 200 ms after the last syllable's onset as a function of L2 proficiency and use. Their values represent the mean (0), one standard deviation below (-1), and one standard deviation above (1) for normalized scores. The first digit in the sub-index indicates whether the effect occurs on the intercept (0), the linear time term (1), or the quadratic time term (2). The second digit refers to the effects themselves (0 = intercept, 1 = Spanish proficiency, 2 = Spanish use, etc.).


```{r, table-l2-probs, eval=T, echo=F}

border_1 <- fp_border(width = 1.5)
border_2 <- fp_border(width = 0.75)


model_preds_l1ot2$target_onset_preds_l2_l1ot2 %>%
  mutate(#stress = if_else(stress == 1, "Present", "Preterit"),
         L1 = if_else(L1 == -1, "English", "Mandarin"),
         L1 = fct_relevel(L1, "English", "Mandarin")) %>%
  # arrange(l1, stress) %>% 
  # group_by(l1, stress) %>%
  # distinct() %>%
  mutate(L1 = blank_same_as_last(as.character(L1)),
         `Spanish proficiency` = blank_same_as_last(as.character(`Spanish proficiency`))
         #stress = blank_same_as_last(as.character(stress))
         ) %>%
  select(L1, `Spanish proficiency`, `Spanish use`,
         Probability = prob, #`Lexical stress` = stress, 
         `Lower bound` = prob_lb, `Upper bound` = prob_ub) %>% 
  flextable() %>% 
  width(., j = c(2, 3, 5, 6), width = c(1.4, 1.2, 1.2, 1.2)) %>%
  font(., fontname = "Times", part = "all") %>%
  fontsize(., size = 11) %>% 
  colformat_num(j = c(4, 5, 6), digits = 2) %>%
  align(., j = 2, align = "right", part = "body") %>%
  border_remove(.) %>%  
  border(., part = "header", 
            border.top = border_1,
            border.bottom = border_2) %>% 
  hline_bottom(., part = "body", border = border_1)

```

*Table 2*: Model estimates for probability of target fixations ±SE at 200 ms after the last syllable's onset as a function of L2 proficiency.


There were several effects.
First, there was a main effect of L2 proficiency on the linear term (<em>&nbsp;chi^2^;</em>&nbsp;(1) =&nbsp;6.499, *p*&nbsp;&lt;&nbsp;.011).
The parameter for that effect is positive (`r report_row(6)`), indicating that as proficiency increased the slope was steeper.
A steeper slope indicates participants increased the number of fixations on the target faster the higher their proficiency.

There was also a main effect of L2 use on the linear term (<em>&nbsp;chi^2^;</em>&nbsp;(1) =&nbsp;14.961, *p*&nbsp;&lt;&nbsp;.000).
However, in the final model after testing all variables and interactions of interest the parameter was not significant.

There was an interaction between L1 and use on the quadratic time term (<em>&nbsp;chi^2^;</em>&nbsp;(1) =&nbsp;11.418, *p*&nbsp;&lt;&nbsp;.001).
In the final model, this effect moved to the linear time term.
The positive value of the parameter indicates that for the Mandarin Chinese population the slope was steeper the higher their L2 use (`r report_row(10)`).
That is, in Chinese participants, more extensive use of Spanish was associated with faster increase of gaze fixations on the target.

Finally, there was a 3-way interaction between L1, L2 proficiency and L2 use on the quadratic term (<em>&nbsp;chi^2^;</em>&nbsp;(1) =&nbsp;11.485, *p*&nbsp;&lt;&nbsp;.001).
Again, however, the parameter switched significance to the linear time term in the final model (`r report_row(14)`).
As shown in Figure 5, English speakers benefited from higher proficiency towards lower levels of Spanish use.
In Mandarin Chinese speakers, in contrast, higher proficiency and L2 use complemented each other, benefiting more those participants with both higher proficiency and greater L2 use, allowing them to predict faster by increasing fixations on the target faster, as represented by their steeper lines.


```{r, 'plot-preds-l2', echo=FALSE, fig.cap="Figure 5. Growth curve analysis estimates of fixations on target as a function of L2 proficiency and L2 use for each L2 group during the analysis window. Lines represent model estimates, and the transparent ribbons represent ±SE. Empirical logit values on y-axis correspond to proportions of 0.12, 0.50, 0.88, and 0.98. The horizontal dotted line represents the 50% probability of fixating on the targets. The vertical dotted line indicates 200 ms after the onset of the last syllable."}
knitr::include_graphics(
  here("figs", "stress", "gca", "LL_changes", "stress_l2_l1ot2.png")
)
```

We checked for multicollinearity between the fixed effects in the model using the variance inflation factor analysis,
All values were below 2 (see Appendix 5), indicating there was no multicollinearity.






# Other plots






# Tables 

## Model estimates at last syllable's onset  

```{r, warning=F}

# Get full mod and make it pretty for the table
pretty_fixed_effects <- gca_mon_mods$gca_mod_mon_base %>% 
  tidy_lme4() %>% 
  mutate(p = format_pval(p), 
         Parameter = fix_param_names(Parameter)) %>% 
  mutate_each(funs(format_fixef_num), Estimate:t) %>% 
  rename(`_t_` = t, `_p_` = p) 

# Include gammas (Gij) after each parameter name
subs <- c(paste0(0:2, 0))
var_labels <- parenthesize(paste0(emphasize("&gamma;"), "~", subs, "~"))
pretty_fixed_effects$Parameter %<>% paste(., var_labels)

# pretty_fixed_effects <- pretty_fixed_effects[0:4,]

pretty_fixed_effects %>% 
  select(-effect) %>%
  knitr::kable(format = "pandoc", align = str_tokenize("lrrrr")) 

```

Appendix 2. Growth Curve Analysis fixed effects (monolinguals)




## Random effects

```{r, 'ranef-table-mon', results = "asis"}
ranef_table <- gca_mon_mods$gca_mod_mon_base %>% 
  tidy_ranef_summary %>% 
  # Format the numbers
  mutate_each(funs(format_fixef_num), vcov, sdcor) %>%
  mutate_each(funs(format_cor), -var1, -grp, -vcov, -sdcor) %>%
  sort_ranef_grps %>%
  # Format variable names and group names
  mutate(var1 = fix_param_names(var1) %>% blank_nas,
         grp =  blank_same_as_last(grp) %>% fix_param_names) %>% 
  rename(Group = grp, Parameter = var1, Variance = vcov, SD = sdcor)

# Correlation columns need names with characters so that pandoc can align them
names(ranef_table)[5:7] <- 
  c("Correlations", "&nbsp;", " &nbsp;", "  &nbsp;", "  &nbsp;")

ranef_table %>% 
  knitr::kable(format = "pandoc", align = str_tokenize("llrrrrrr"))
```




Appendix 5.Growth curve model random effects (monolinguals)





```{r, 'ranef-table-l2', results = "asis"}
ranef_table <- gca_l2$gca_l2_nt_2 %>% 
  tidy_ranef_summary %>% 
  # Format the numbers
  mutate_each(funs(format_fixef_num), vcov, sdcor) %>%
  mutate_each(funs(format_cor), -var1, -grp, -vcov, -sdcor) %>%
  sort_ranef_grps %>%
  # Format variable names and group names
  mutate(var1 = fix_param_names(var1) %>% blank_nas,
         grp =  blank_same_as_last(grp) %>% fix_param_names) %>% 
  rename(Group = grp, Parameter = var1, Variance = vcov, SD = sdcor)

# Correlation columns need names with characters so that pandoc can align them
names(ranef_table)[5:10] <- 
  c("Correlations", "&nbsp;", " &nbsp;", "  &nbsp;", "  &nbsp;", "&nbsp;")

ranef_table %>% 
  knitr::kable(format = "pandoc", align = str_tokenize("llrrrrrr"))
```

Appendix 6: Growth curve model random effects (L2)

# References

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refere"></div>
\endgroup

