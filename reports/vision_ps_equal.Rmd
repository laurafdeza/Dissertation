---
title             : "Results"
shorttitle        : "Title"

author: 
  - name          : "Laura Fernandez Arroyo"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Postal address"
    email         : "my@email.com"
  - name          : "Nuria Sagarra"
    affiliation   : "1"
  - name          : "Cristina Lozano Argüelles"
    affiliation   : "2"

affiliation:
  - id            : "1"
    institution   : "Rutgers University"
  - id            : "2"
    institution   : "John Jay College of Criminal Justice"



keywords          : ""
wordcount         : ""


floatsintext      : yes
figurelist        : yes
tablelist         : yes
footnotelist      : yes
linenumbers       : yes
mask              : yes
draft             : yes

documentclass     : "apa6"
classoption       : "man"
output            : papaja::apa6_word
---

```{r setup, include = FALSE, warning=FALSE}
library("papaja")
library("officer")
library("flextable")
```

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```

```{r, 'source-scripts-models'}
#source(here::here("scripts", "02_load_data.R"))
source(here::here("scripts", "01_helpers.R"))

# Get path to saved models
gca_mods_path  <- here("mods", "vision", "gca", "cont_speed_verb")

# Load models as lists
load(paste0(gca_mods_path, "/mon_mods_psequal.Rdata"))
load(paste0(gca_mods_path, "/model_preds_psequal.Rdata"))


```

4.4. Data analysis 
<!-- I know this should be one sentence per line, it's just copy-pasted from Word -->
Statistical analyses were conducted on R (Team & others, 2013) with the package lme4 (Bates, Mächler, Bolker, & Walker, 2014). The gaze fixation data were downsampled to 50 ms bins and incorrect responses were filtered out (0.42% of data). The data were centered 200 ms after the onset of the last syllable to account for saccade planning and launching, as is standard procedure in auditory eye-tracking studies (e.g., Fischer, 1992; Saslow, 1967).

In the visuospatial prediction data, trials that timed out before the participant pressed the key were discarded (~25%). Those trials whose timing exceeded two standard deviations from the mean were also removed, imitating Broeker et al. (2020). The clead data was analyzed using a generalized linear mixed model. The timing of the key press was used as outcome. The predictors were speed of the trial and direction of the car (contrast-coded). Since speed had three levels, pairwise comparisons were run. The model also contained by-subject random intercepts. The random effects not explained by the model were used as measure of visuospatial prediction ability for later analyses.

Verbal and visuospatial processing speed were calculated from only correct trials. For verbal processing speed, we recorded the time it took participants to answer the mathematical problems. This time was used as the outcome of a generalized linear mixed effect model with length of the set (number of mathematical operations and words to remember) as predictor and by-subject random intercepts. For visuospatial processing speed, we recorded the time participants needed to recreate the sequences. Again, these data were run as outcome of a generalized linear mixed model with sequence length (number of squares to recall) as predictor and by-subject random intercepts. The random variances not explained by the models were used as respective measures of processing speed.
Negative values indicated shorter reaction times, and thus faster processing speed.

Growth curve analyses (GCA, Mirman, 2016) with mixed effects were used to analyze the association between processing speeds and visuospatial prediction with verbal prediction in the time window around the verb encompassing the departure of looks from chance levels. 
The time window spanned from 200 ms before to 200 ms after the onset of the last syllable in the verb. 
We ran two GCAs. 
The first one included stress pattern, the two processing speeds, the linear and quadratic orthogonal polynomial time terms as fixed effects.
Running this model allows comparison of processing speed of different types of information within the same model to compare how much of the variance in responses are explained by the modality in which it is received. 
The second one included stress pattern, visuospatial prediction ability, visuospatial processing speed, the linear and quadratic orthogonal polynomial time terms as fixed effects.
This model allows direct comparison of effects of both visuospatial measures.
By-subject random intercepts and by-stress pattern, linear orthogonal polynomial time term and quadratic orthogonal polynomial time term random slopes were included in all GCAs. 
Main effects and interactions were assessed by means of nested model comparisons. 
The linear and quadratic orthogonal polynomial time terms model the time course in the GCA. 
The outcome data, proportion of fixations on the target at the onset of the last syllable on the verb from the eye-tracking prediction task, was modified using the weighted empirical logic transformation, as it is binary data (fixations on the target or the distractor; Barr, 2008).


# Results

Figure 5 shows the time course of participants’ fixations on the targets during our time window. 
As observed, monolingual speakers start to direct their gaze to the target above chance before hearing the suffix. 
That is, they were fixating on the target above chance at the onset of the last syllable in the verbs—the syllable containing the suffix to be predicted.

```{r, 'plot-corsi-preds', echo=FALSE, fig.cap="5. Time course of fixations on the target verb."}
knitr::include_graphics(
  here("figs", "vision", "gca", "cont_speed_verb", "timecourse_mon_psequal.png")
)
```

```{r, 'write-up-prep-ps', warning=F, eval=T}
# Prepare table to support easy in-line printing of equations
# params <- pretty_fixed_effects %>% 
#  rename(B = Estimate)

params <- mon_mods_psequal$gca_mon_ospan_i_2 %>% 
  tidy_lme4() %>% 
  rename(B = Estimate)

params$subscript <- 
  c(paste0(0:3, 0), paste0(0:2, 1))

params <- tibble::column_to_rownames(params, 'subscript')

params$subscript <- 
  c(paste0(0:3, 0), paste0(0:2, 1))

# Shortcut for inline reporting from the above table
report_row <- function(row_name) report_fixef_row(params, row_name)

# Pre-calculate intercept as proportion
b0 <- params$B[params$subscript == "00"] %>% as.numeric
b0_prop <- b0 %>% inv_logit %>% round(2) %>% remove_leading_zero

```

Only the model with processing speeds yielded main effects and interactions and will therefore be the only one reported here.
For full model formula and summary see Appendix 2.
The log odds of participants fixating on the target at 200 ms after the objective onset of the last syllable in the verb estimated by the model is `r report_row(1)` (proportion = `r print(b0_prop`).
The exact probabilities for each condition can be found in Table 1.

```{r, props-ospanrt, eval=T, echo=F, include=TRUE}

border_1 <- fp_border(width = 1.5)
border_2 <- fp_border(width = 0.75)

model_preds_psequal$preds_mon_ospan %>% 
  mutate(stress = if_else(stress == -1, "paroxytone", "oxytone")) %>% 
  arrange(desc(stress), ospan_rt) %>% 
  mutate(stress = blank_same_as_last(as.character(stress)),
         ospan_rt = blank_same_as_last(as.character(ospan_rt))) %>%
  select(`Lexical stress` = stress, #`Visual prediction timing` = car_dev,
         `Verbal processing speed` = ospan_rt,
         `Visuospatial processing speed` = corsi_rt,
         Probability = prob, `Lower bound` = prob_lb, 
         `Upper bound` = prob_ub) %>% 
  flextable() %>% 
  padding(padding = 0, part = "all") %>% 
  width(., j = c(1:3, 5, 6), width = c(1.1, 1.1, 1.1, 1.2, 1.2)) %>% 
  font(., fontname = "Times", part = "all") %>%
  colformat_num(., j = c(4:6), digits = 2) %>%
  fontsize(., size = 11) %>% 
  align(., j = 2, align = "right", part = "body") %>%
  border_remove(.) %>%  
  border(., part = "header", 
            border.top = border_1,
            border.bottom = border_2) %>% 
  hline_bottom(., part = "body", border = border_1)
```

*Table 1.* Model estimates for probability of target fixations ±SE 
at 200 ms after the last syllable onset. Verbal and visuospatial processing speed values are give for our sample's mean (0), one standard deviation above (1, longer reaction times, slower processing speeds) and one standard deviation below (-1, shorter reaction times, faster processing speeds).

We kept the linear (`r report_row(2)`), quadratic (`r report_row(3)`) and cubic (`r report_row(4)`) polynomial time terms.
There was only an interaction between stress pattern and verbal processing speed on the quadratic time term (<em>&nbsp;chi^2^;</em>&nbsp;(1) =&nbsp;4.90, *p* = 0.027).
Those participants with average verbal processing speed predicted oxytones and paroxytones, but with faster verbal processing speed, oxytones were predicted faster than paroxytones, while the reverse happened in participants with slower processing speed (`r report_row(7)`).

```{r, table-ospanrt-params, warning=F}

# Get full mod and make it pretty for the table
pretty_fixed_effects <- mon_mods_psequal$gca_mon_ospan_i_2 %>%  
  tidy_lme4() %>% 
  mutate(p = format_pval(p), 
         Parameter = fix_param_names(Parameter)) %>% 
  mutate_each(funs(format_fixef_num), Estimate:t) %>% 
  rename(`_t_` = t, `_p_` = p) 

# Include gammas (Gij) after each parameter name
subs <- c(paste0(0:3, 0), paste0(0:2, 1))
var_labels <- parenthesize(paste0(emphasize("&gamma;"), "~", subs, "~"))
pretty_fixed_effects$Parameter %<>% paste(., var_labels)

pretty_fixed_effects %>% 
  select(-effect) %>%
  knitr::kable(format = "pandoc", align = str_tokenize("lrrrr")) 


```

```{r, 'plot-ospan-preds-mon', echo=FALSE, fig.cap="4. Growth curve estimates of target fixations as a function of verbal processing speed for L1 Spanish speakers according to stress pattern during the analysis window. Symbols and lines represent model estimates, and the transparent ribbons represents ±SE. Empirical logit values on y-axis correspond to proportions of 0.50, 0.73. 0.88, and 0.95. The horizontal dotted line represents the 50% probability of fixating on the target. The vertical dotted line indicates 200 ms after the offset of the first syllable of the verb."}
knitr::include_graphics(
  here("figs", "vision", "gca", "cont_speed_verb", "mon_gca_psequal.png")
)
```





# Tables 

## Random effects

```{r, 'ranef-table-ps', results = "asis"}
ranef_table <- mon_mods_psequal$gca_mon_ospan_i_2 %>% 
  tidy_ranef_summary %>% 
  # Format the numbers
  mutate_each(funs(format_fixef_num), vcov, sdcor) %>%
  mutate_each(funs(format_cor), -var1, -grp, -vcov, -sdcor) %>%
  sort_ranef_grps %>%
  # Format variable names and group names
  mutate(var1 = fix_param_names(var1) %>% blank_nas,
         grp =  blank_same_as_last(grp) %>% fix_param_names) %>% 
  rename(Group = grp, Parameter = var1, Variance = vcov, SD = sdcor)

# Correlation columns need names with characters so that pandoc can align them
names(ranef_table)[5:9] <- 
  c("Correlations", "&nbsp;", " &nbsp;", "  &nbsp;", "   &nbsp;")

ranef_table %>% 
  knitr::kable(format = "pandoc", align = str_tokenize("llrrrrrr"))
```

Appendix 2: Growth curve model random effects

